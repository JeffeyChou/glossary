---
date: 2023-05-13 19:43:50
categories: Numerical_Analysis 
destination: 
excerpt: 
katex: true
obsidianUIMode: source
rating: ⭐⭐
draft: false
tags:  
- 作业 
- Numerical_Analysis 
title: "数值分析作业-数值微分"
share: false
---

> [!question]+ HW
> 1、分析数值导数 $\hat{f}^{\prime}(x)=\frac{f(x-2 h)-4f(x-h)+3 f(x)}{2 h}$ 的误差, 并用 Richardson 外推法提高其精度。
> 2、已知点 $x-2 h, x-h, x, x+h, x+2 h$ , 用待定系数法推导计算 $f^{\prime \prime}(x)$ 的尽可能高精度的数值格式。
> 3、编程: 用第 $1 、 2$ 题中的数值格式计算 $f(x)=e^x$ 在 $x=0$ 处的一阶和二阶导数, 取 $h=$ $10^{-1} \sim 10^{-9}$ , 考察误差的收敛性。

---

## 1. 分析数值导数 $\hat{f}^{\prime}(x)=\frac{f(x-2 h)-4f(x-h)+3 f(x)}{2 h}$ 的误差, 并用 Richardson 外推法提高其精度。

### 1.1. 误差分析

$$f(x-2h) = f(x) - 2hf'(x) + 2h^2f''(x) - \frac{4}{3}h^3f'''(x) + O(h^4)$$

$$f(x-h) = f(x) - hf'(x) + \frac{1}{2}h^2f''(x) - \frac{1}{6}h^3f'''(x) + O(h^4)$$

$$f(x) = f(x)$$

将上述三式代入数值导数的定义中，得到相应的数值公式为：

$$\hat{f}^{\prime}(x)=\frac{f(x-2 h)-4f(x-h)+3 f(x)}{2 h} = f'(x) - \frac{1}{3}h^2f'''(x) + O(h^3)$$

所以误差项为：$\hat{f}^{\prime}(x)-f'(x) = -\frac{1}{3}h^2f'''(x_0) + O(h^3)$, 其中 $x_0$ 为 $x$ 与 $x-2h$ 之间的某一点。

### 1.2. Richardson 外推法

$$
\begin{aligned}
\hat{F}^{\prime}(x) &= 2\hat{f}'(h/2)- \hat{f}'(h)\\
&= \frac{2f(x-h)-8f(x-h/2)+6 f(x)}{h}- \frac{f(x-2 h)-4f(x-h)+3 f(x)}{2 h}\\
&= \frac{-16f(x-h/2)+15f(x)-f(x-2h)}{2h}
\end{aligned}
$$

---

## 2. 已知点 $x-2 h, x-h, x, x+h, x+2 h$ , 用待定系数法推导计算 $f^{\prime \prime}(x)$ 的尽可能高精度的数值格式。

### 2.1. 五点中心差分格式

根据Taylor公式有： 
<!-- $$
f^{\prime \prime}(x)=\frac{f(x-2 h)-2 f(x-h)+2 f(x+h)-f(x+2 h)}{h^{2}}+O\left(h^{4}\right)
$$ -->

$$
\begin{aligned}
    f^{\prime \prime}(x)&= \sum\limits_{i=-2}^{2} a_i f(x+ih)\\
    &= \sum\limits_{i=-2}^{2}\left[ a_i f(x) + a_i ih f'(x) + a_i \frac{(ih)^2}{2!}f''(x) + a_i \frac{(ih)^3}{3!}f'''(x) + a_i \frac{(ih)^4}{4!}f''''(x) + O(h^5)    \right] \\
    &= f''(x) + O(h^5)  
\end{aligned}
$$
整理成矩阵得到：

$$
\left[
\begin{matrix}
    1 & 1 & 1 & 1 & 1 \\
    -2h & -h & 0 & 1h & 2h \\
    2h^2 & 1/2h^2 & 0 & 1/2h^2 & 2h^2 \\
    8/6 h^3 & -1/6 h^3 & 0 & 1/6 h^3 & 8/6 h^3 \\
    16/24 h^4 & -1/24 h^4 & 0 & 1/24 h^4 & 16/24 h^4
\end{matrix}
\right]
\left[
\begin{matrix}
    a_{-2} \\
    a_{-1} \\
    a_0 \\
    a_1 \\
    a_2
\end{matrix}
\right]=
\left[
\begin{matrix}
    0 \\
    0 \\
    1 \\
    0 \\
    0
\end{matrix}
\right]
$$

求解矩阵得到：

$$
\left[
\begin{matrix}
    a_{-2} \\
    a_{-1} \\
    a_0 \\
    a_1 \\
    a_2
\end{matrix}
\right]=
\left[
\begin{matrix}
    0 \\
    1 \\
    -2 \\
    1 \\
    0
\end{matrix}
\right]
$$

$$
f''(x)=\frac{f(x-h)-2 f(x)+f(x+h)}{h^{2}}+O\left(h^{4}\right)
$$

## 3. 编程: 用第 $1 、 2$ 题中的数值格式计算 $f(x)=e^x$ 在 $x=0$ 处的一阶和二阶导数, 取 $h=$ $10^{-1} \sim 10^{-9}$ , 考察误差的收敛性。

### 3.1. 代码

```python
import numpy as np
import matplotlib.pyplot as plt
from math import exp
h=np.logspace(10e-1,10e-9,9)


def f(x):
    return exp(x)

def f1(x):
    return (f(x-2h)-4*f(x-h)+3*f(x))/2h

def f2(x):
    return (-16*f(x-h/2)+15*f(x)-f(x-2h))/(2h)




```